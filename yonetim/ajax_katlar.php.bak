<?php
require_once __DIR__.'/../ortak/oturum.php';
require_once __DIR__.'/../ortak/db_helpers.php';
require_once __DIR__.'/../ortak/guvenlik.php';
require_once __DIR__.'/../ortak/yetki.php';
require_role(['GENEL','MUDUR']);

header('Content-Type: application/json; charset=utf-8');

$bina_id = (int)($_GET['bina_id'] ?? 0);
if($bina_id <= 0){
    echo json_encode(['ok'=>true,'data'=>[]]);
    exit;
}

$katlar = fetch_all("SELECT id, ad FROM katlar WHERE bina_id=? ORDER BY ad",[$bina_id]);
echo json_encode(['ok'=>true,'data'=>$katlar]);