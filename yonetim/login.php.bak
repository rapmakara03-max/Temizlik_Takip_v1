<?php
require_once __DIR__ . '/../ortak/oturum.php';
require_once __DIR__ . '/../ortak/sabitler.php';
require_once __DIR__ . '/../ortak/yetki.php';
require_once __DIR__ . '/../ortak/csrf.php';

if (current_user()) redirect(app_url('yonetim/pano.php'));

if (is_post()) {
    csrf_check();
    $email=trim($_POST['email']??'');
    $pass=trim($_POST['parola']??'');
    if(!$email||!$pass){
        flash_set('error','E-posta ve parola zorunlu.');
    }else{
        if(login_user_demo_or_db($email,$pass,['GENEL','MUDUR'])){
            flash_set('success','Giriş başarılı.');
            $ret=$_GET['return']??'';
            redirect($ret?app_url(ltrim($ret,'/')):app_url('yonetim/pano.php'));
        }else flash_set('error','Geçersiz bilgi.');
    }
}

?>
<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Yönetim Giriş</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
<style>
body{background:#f4f6f9;}
.login-box{max-width:380px;margin:60px auto;padding:25px;background:#fff;border-radius:8px;box-shadow:0 4px 14px rgba(0,0,0,.1);}
</style>
</head>
<body>
<div class="login-box">
    <h4 class="mb-3 text-center">Yönetim Giriş</h4>
    <?php foreach(flash_get_all() as $f): ?>
        <div class="alert alert-<?php echo $f['t']==='error'?'danger':h($f['t']); ?> mb-2"><?php echo h($f['m']); ?></div>
    <?php endforeach; ?>
    <form method="post">
        <?php echo csrf_field(); ?>
        <div class="form-group">
            <label>E-posta</label>
            <input type="email" name="email" class="form-control" required autofocus>
        </div>
        <div class="form-group">
            <label>Parola</label>
            <input type="password" name="parola" class="form-control" required>
        </div>
        <button class="btn btn-primary btn-block">Giriş</button>
        <div class="small text-muted mt-2">
            Demo: <?php echo h(env('ADMIN_DEMO_EMAIL')); ?> / <?php echo h(env('ADMIN_DEMO_PASS')); ?>
        </div>
    </form>
</div>
</body>
</html>